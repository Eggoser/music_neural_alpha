# Нейросеть на Keras для анализа музыки

С помощью моей нейросети можно подобрать музыкальные треки, закрузив на сайт всего один mp3 трек.
Процесс обработки загружаемого трека 8-10 секунд (зависит от размера).

Проект представляет из себя сверточную нейросеть, которая была обучена(не мной) с использованием фреймворка keras.

## Пару слов про модель
Модель была обучена не мной потому, что я не располагал компьютером достаточно мощным железом и большим объемом ОЗУ. Обученную модель я взял [здесь](https://github.com/VikramShenoy97/Music-Recommendation-Using-Deep-Learning). 
Датасет они брали [отсюда](https://github.com/mdeff/fma), даже не смотря на то что модель скопирована, считаю важным это указать.


## Архитектура
Чтобы проект не был сырым, он работает под управлением веб-приложения, написанного на flask.
Сайт сделан с применением Bootstrap, JQuery и стандартных (html, css, js).
На github представлен только код самого приложения, парсинг данных я делал на стороне. Поэтому взглянуть на ноутбук не получится (К тому же я ими не пользовался). 
В итоге около 1500 музыкальных произведений с Яндекс.Музыки. Компьютер потратил 12 часов времени на их обработку.
Там также использовалась моя [библиотека](https://github.com/Eggoser/yamusic) для загрузки треков с яндекса, она пока не документирована, но со своей задачей справилась.

Чтобы модель могла распознавать музыку (подготовка данных):
1. Нужно преобразовать каждый файл в wav, желательно открывать их в буфере и сразу производить шаг 2, т.к. один файл весит около 50мб
1. Далее создаем mel спектрограмму для каждого wav файла и преобразуем амплитуду в децибелы
1. Mel спектрограмма большая в длину(портянка), поэтому разбиваем её на куски 128x128

Чтобы модель могла распознавать музыку (тренировка):
1. Из исходной модели убираем самый последний слой
1. Делаем предсказание для каждого кусочка на полученной модели 128x128, на выходе получаем матрицу 32x1
1. Для каждого трека находим среднее арифметическое между матрицами, на выходе получаем матрицу такого же размера
1. Сохраняем матрицы, они пригодятся для выполнения итоговых прогнозов

Что происходит когда пользователь отправляет трек:
1. Из отправленного трека создается mel спектрограмма (~4 секунды)
1. mel спектрограмма нарезается на кусочки 128x128 (~0.3 секунды)
1. Кормим нейросеть каждым кусочком, получив набор матриц, и находим среднее арифметическое, получив одну матрицу (~4 секунды)
1. А вот здесь мы возвращаемся к раннее сохранненным матрицам, мы находим косинусное свойство между ними и единственной матрицей (~0.2 секунды)
1. Сортируем получившийся список по возрастанию, подгружаем лейблы и возвращаем пользователю

## Развертывание
К сожалению развертывание сделать невозможно, т. к. мой проект не был изначально для этого предназначен. Могу порадовать вас уже собранным и деплойнутым сайтом.

## Нет желания смотреть код?
На моем хостинге развернуто flask-приложение. [Взгляните](http://vmi456545.contaboserver.net/). l-o-g-i-n: hello, p-a-s-s-w-o-r-d: world. Очень прошу: ничего не ломать, не пентестить, и следовать инструкциям приложения :)